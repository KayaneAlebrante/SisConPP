generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Candidato {
  idCandidato                 Int                       @id @default(autoincrement())
  nomeCompleto                String
  cidade                      String
  estado                      String
  CTG                         CTG                       @relation(fields: [CTGId], references: [idCTG])
  CTGId                       Int                       @default(0)
  numCarteirinha              String
  CPF                         String
  RG                          String
  endereco                    String
  numEndereco                 Int
  bairro                      String
  escolaridade                String
  filiacaoPai                 String
  filiacaoMae                 String
  ProvaCampeiraEsportiva      ProvaCampeiraEsportiva?
  anexoFoto                   Bytes?
  anexoDocumento              Bytes?
  anexoCarteirinha            Bytes?
  anexoEscolaridade           Bytes?
  anexoResidencia             Bytes?
  anexoAtaConcurso            Bytes?
  fichaInscricao              Bytes?
  anexoTermoCandidato         Bytes?
  anexoRelatorioVivencia      Bytes?
  anexoResponsavel            Bytes?
  anexoProvaEsportivaCampeira Bytes?
  PreferenciaSorteioDanca     PreferenciaSorteioDanca[]
  Categoria                   Categoria                 @relation(fields: [categoriaId], references: [idCategoria])
  categoriaId                 Int

  avalicoes          Avaliacao[]
  sorteioDanca       SorteioDanca[]
  Recurso            Recurso[]
  Concurso           Concurso?      @relation(fields: [concursoIdConcurso], references: [idConcurso])
  concursoIdConcurso Int?
}

enum ProvaCampeiraEsportiva {
  CAMPEIRA
  ESPORTIVA
  AMBAS
  NENHUMA
}

model Usuario {
  idUsuario         Int            @id @default(autoincrement())
  nomeCompleto      String
  cidade            String
  estado            String
  CTG               CTG            @relation(fields: [CTGId], references: [idCTG])
  CTGId             Int            @default(0)
  numCarteirinha    String
  login             String         @unique
  senha             String
  funcao            Funcao
  credenciamento    Credenciamento @default(NAO_CREDENCIADO)
  numCredenciamento Int?

  comissaoUsuarioId Int?
  ComissaoUsuario   ComissaoUsuario? @relation
  avalicoes         Avaliacao[]
  recursos          Recurso[]
  sorteioDanca      SorteioDanca[]
}

enum Funcao {
  SECRETARIO
  AVALIADOR
  AUXILIAR
}

enum Credenciamento {
  CREDENCIADO
  NAO_CREDENCIADO
}

model CTG {
  idCTG   Int    @id @default(autoincrement())
  nomeCTG String @db.VarChar(100)

  RTid      Int
  RT        RT          @relation(fields: [RTid], references: [idRT])
  Usuario   Usuario[]
  Candidato Candidato[]
}

model RT {
  idRT     Int    @id @default(autoincrement())
  nomeRT   String @db.VarChar(100)
  numeroRT Int?
  CTGs     CTG[]
}

model PreferenciaSorteioDanca {
  idPreferencia    Int                   @id @default(autoincrement())
  nomeSorteioDanca DancaSalaoTradicional
  candidatoId      Int
  Candidato        Candidato             @relation(fields: [candidatoId], references: [idCandidato])
  SorteioDanca     SorteioDanca?         @relation(fields: [sorteioDancaId], references: [idSorteio])
  sorteioDancaId   Int?
  quesitos         Quesitos[]

  @@unique([candidatoId, nomeSorteioDanca])
}

model Concurso {
  idConcurso         Int      @id @default(autoincrement())
  nomeConcurso       String   @db.VarChar(100)
  lancamentoEdital   DateTime
  inscricoesInicio   DateTime
  inscricoesFinal    DateTime
  dataProvaEscrita   DateTime
  dataProvasPraticas DateTime
  dataResultado      DateTime
  local              String   @db.VarChar(255)
  anexoEdital        Bytes?

  candidatos Candidato[]
  comissoes  Comissao[]
}

model Comissao {
  idComissao   Int    @id @default(autoincrement())
  nomeComissao String @db.VarChar(100)

  concurso   Concurso          @relation(fields: [concursoId], references: [idConcurso])
  concursoId Int
  avalicao   Avaliacao[]
  usuarios   ComissaoUsuario[]
}

model ComissaoUsuario {
  idComissaoUsuario Int      @id @default(autoincrement())
  comissaoId        Int
  usuarioId         Int      @unique
  Comissao          Comissao @relation(fields: [comissaoId], references: [idComissao])
  Usuarios          Usuario  @relation(fields: [usuarioId], references: [idUsuario])

  @@unique([comissaoId, usuarioId])
}

model Categoria {
  idCategoria   Int    @id @default(autoincrement())
  nomeCategoria String @db.VarChar(50)
  escolaridade  String
  sorteioDanca  Int
  idadeInicial  Int
  idadeLimite   Int?

  candidatos Candidato[]

  provaTeoricaId Int?
  ProvaTeorica   ProvaTeorica? @relation(fields: [provaTeoricaId], references: [idprovaTeorica], onDelete: SetNull)

  provaPraticaId Int?
  ProvaPratica   ProvaPratica? @relation(fields: [provaPraticaId], references: [idProvaPratica], onDelete: SetNull)
}

model Avaliacao {
  idAvalicao    Int      @id @default(autoincrement())
  dataAvaliacao DateTime @default(now())

  comissaoId Int
  Comissao   Comissao @relation(fields: [comissaoId], references: [idComissao])

  avaliadorId Int
  Usuario     Usuario @relation(fields: [avaliadorId], references: [idUsuario])

  provaPraticaId Int?
  ProvaPratica   ProvaPratica? @relation(fields: [provaPraticaIdProvaPratica], references: [idProvaPratica])

  provaTeoricaId Int?
  ProvaTeorica   ProvaTeorica? @relation(fields: [provaTeoricaIdprovaTeorica], references: [idprovaTeorica])

  blocoProvaId Int?
  BlocoProva   BlocoProva? @relation(fields: [blocoProvaId], references: [idBloco])

  quesitos Quesitos[]
  nota     Float

  candidatoId Int
  Candidato   Candidato @relation(fields: [candidatoId], references: [idCandidato])

  fichaCandidatoIdFicha      Int?
  FichaCandidato             FichaCandidato? @relation(fields: [fichaCandidatoIdFicha], references: [idFicha])
  provaPraticaIdProvaPratica Int?
  provaTeoricaIdprovaTeorica Int?
}

model ProvaTeorica {
  idprovaTeorica  Int         @id @default(autoincrement())
  nomeProva       String
  notaMaxima      Float
  gabaritoOficial Bytes
  numQuestao      Int
  quesitos        Quesitos[]
  categorias      Categoria[]
  avaliacoes      Avaliacao[]
  recursos         Recurso[]
}

model ProvaPratica {
  idProvaPratica Int          @id @default(autoincrement())
  nomeProva      String
  notaMaxima     Float
  blocosProvas   BlocoProva[]
  categorias     Categoria[]
  avaliacoes     Avaliacao[]
  recursos        Recurso[]
}

model BlocoProva {
  idBloco         Int           @id @default(autoincrement())
  nomeBloco       String
  notaMaximaBloco Float
  ProvaPratica    ProvaPratica? @relation(fields: [provaPraticaId], references: [idProvaPratica])
  provaPraticaId  Int?
  quesitos        Quesitos[]
  Avaliacao       Avaliacao[]
}

model Quesitos {
  idQuesito             Int                   @id @default(autoincrement())
  nomeQuesito           String
  notaMaximaQuesito     Float
  danca                 Boolean
  opcional              Boolean @default(false)
  dancaSalaoTradicional DancaSalaoTradicional

  BlocoProva        BlocoProva? @relation(fields: [blocoProvaIdBloco], references: [idBloco])
  blocoProvaIdBloco Int?

  ProvaTeorica               ProvaTeorica? @relation(fields: [provaTeoricaIdprovaTeorica], references: [idprovaTeorica])
  provaTeoricaIdprovaTeorica Int?

  subQuesitos              SubQuesitos[]
  recursos                  Recurso[]
  PreferenciaSorteioDanca   PreferenciaSorteioDanca? @relation(fields: [preferenciaSorteioDancaId], references: [idPreferencia])
  preferenciaSorteioDancaId Int?
  Avaliacao                 Avaliacao?               @relation(fields: [avaliacaoIdAvalicao], references: [idAvalicao])
  avaliacaoIdAvalicao       Int?
}

model SubQuesitos {
  idSubequestios  Int    @id @default(autoincrement())
  nomeSubquesito  String
  notaSubequesito Float

  quesitoId Int
  Quesito   Quesitos @relation(fields: [quesitoId], references: [idQuesito])

  subequesitosFilhos SubQuesitos[] @relation("SubQuesitosSub")
  subequesitosPai    SubQuesitos[] @relation("SubQuesitosSub")
}

model Recurso {
  idRecurso     Int      @id @default(autoincrement())
  nomeRecurso   String
  justificativa String
  status        Boolean
  dataRecurso   DateTime @default(now())
  arquivos      Bytes

  candidato Int
  Candidato Candidato @relation(fields: [candidato], references: [idCandidato])
  avaliador Int
  Usuario   Usuario   @relation(fields: [avaliador], references: [idUsuario])

  quesitoRecurso             Int
  Quesito                    Quesitos      @relation(fields: [quesitoRecurso], references: [idQuesito])
  ProvaTeorica               ProvaTeorica? @relation(fields: [provaTeoricaIdprovaTeorica], references: [idprovaTeorica])
  provaTeoricaIdprovaTeorica Int?
  ProvaPratica               ProvaPratica? @relation(fields: [provaPraticaIdProvaPratica], references: [idProvaPratica])
  provaPraticaIdProvaPratica Int?
}

enum DancaSalaoTradicional {
  DANCA_DE_SALAO
  DANCA_TRADICIONAL
  NENHUMA
}

model SorteioDanca {
  idSorteio        Int                   @id @default(autoincrement())
  resultadoSorteio Int
  dataSorteio      DateTime              @default(now())
  tipoDanca        DancaSalaoTradicional

  preferenciaSorteioDancaIds PreferenciaSorteioDanca[]

  candidatoId Int
  Candidato   Candidato @relation(fields: [candidatoId], references: [idCandidato])

  usuarioId Int
  Usuario   Usuario @relation(fields: [usuarioId], references: [idUsuario])
}

model FichaCandidato {
  idFicha       Int         @id @default(autoincrement())
  candidatoId   Int
  notaCandidato Float
  avaliacoes    Avaliacao[]
  provaId       Int
  concursoId    Int
  categoriaId   Int

  anexoTermodeCiencia Bytes
  dataTermo           DateTime @default(now())

  numAcertosProvaTeorica Int
  anexoGabarito          Bytes
  notaRedacao            Float
  anexoRedacao           Bytes
  anexoProvaPratica      Bytes
}
