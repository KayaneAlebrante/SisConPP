generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Candidato {
  idCandidato                 Int                       @id @default(autoincrement())
  nomeCompleto                String
  cidade                      String
  estado                      String
  CTG                         CTG                       @relation(fields: [CTGId], references: [idCTG])
  CTGId                       Int                       @default(0)
  numCarteirinha              String
  CPF                         String
  RG                          String
  endereco                    String
  numEndereco                 Int
  bairro                      String
  escolaridade                String
  filiacaoPai                 String
  filiacaoMae                 String
  ProvaCampeiraEsportiva      ProvaCampeiraEsportiva?
  anexoFoto                   Bytes?
  anexoDocumento              Bytes?
  anexoCarteirinha            Bytes?
  anexoEscolaridade           Bytes?
  anexoResidencia             Bytes?
  anexoAtaConcurso            Bytes?
  fichaInscricao              Bytes?
  anexoTermoCandidato         Bytes?
  anexoRelatorioVivencia      Bytes?
  anexoResponsavel            Bytes?
  anexoProvaEsportivaCampeira Bytes?
  PreferenciaSorteioDanca     PreferenciaSorteioDanca[]
  Categoria                   Categoria                 @relation(fields: [categoriaId], references: [idCategoria])
  categoriaId                 Int

  avalicoes          Avaliacao[]
  sorteioDanca       SorteioDanca[]
  Recurso            Recurso[]
  Concurso           Concurso?      @relation(fields: [concursoIdConcurso], references: [idConcurso])
  concursoIdConcurso Int?
}

enum ProvaCampeiraEsportiva {
  CAMPEIRA
  ESPORTIVA
  AMBAS
  NENHUMA
}

model Usuario {
  idUsuario         Int            @id @default(autoincrement())
  nomeCompleto      String
  cidade            String
  estado            String
  CTG               CTG            @relation(fields: [CTGId], references: [idCTG])
  CTGId             Int            @default(0)
  numCarteirinha    String
  login             String         @unique
  senha             String
  funcao            Funcao
  credenciamento    Credenciamento @default(NAO_CREDENCIADO)
  numCredenciamento Int?

  comissaoUsuarioId Int?
  ComissaoUsuario   ComissaoUsuario? @relation
  avalicoes         Avaliacao[]
  recursos          Recurso[]
  sorteioDanca      SorteioDanca[]
}

enum Funcao {
  SECRETARIO
  AVALIADOR
  AUXILIAR
}

enum Credenciamento {
  CREDENCIADO
  NAO_CREDENCIADO
}

model CTG {
  idCTG   Int    @id @default(autoincrement())
  nomeCTG String @db.VarChar(100)

  RTid      Int
  RT        RT          @relation(fields: [RTid], references: [idRT])
  Usuario   Usuario[]
  Candidato Candidato[]
}

model RT {
  idRT     Int    @id @default(autoincrement())
  nomeRT   String @db.VarChar(100)
  numeroRT Int?
  CTGs     CTG[]
}

model PreferenciaSorteioDanca {
  idPreferencia    Int                   @id @default(autoincrement())
  nomeSorteioDanca DancaSalaoTradicional
  candidatoId      Int
  Candidato        Candidato             @relation(fields: [candidatoId], references: [idCandidato])
  SorteioDanca     SorteioDanca?         @relation(fields: [sorteioDancaId], references: [idSorteio])
  sorteioDancaId   Int?
  dancas           Danca[]

  @@unique([candidatoId, nomeSorteioDanca])
}

model Concurso {
  idConcurso         Int      @id @default(autoincrement())
  nomeConcurso       String   @db.VarChar(100)
  lancamentoEdital   DateTime
  inscricoesInicio   DateTime
  inscricoesFinal    DateTime
  dataProvaEscrita   DateTime
  dataProvasPraticas DateTime
  dataResultado      DateTime
  local              String   @db.VarChar(255)
  anexoEdital        Bytes?

  candidatos Candidato[]
  comissoes  Comissao[]
}

model Comissao {
  idComissao   Int    @id @default(autoincrement())
  nomeComissao String @db.VarChar(100)

  concurso   Concurso @relation(fields: [concursoId], references: [idConcurso])
  concursoId Int

  avalicao    Avaliacao[]
  usuarios    ComissaoUsuario[]
  atribuicoes ComissaoProvaPratica[]
}

model ComissaoProvaPratica {
  idComissaoProvaPratica Int @id @default(autoincrement())

  comissaoId Int
  Comissao   Comissao @relation(fields: [comissaoId], references: [idComissao])

  categoriaId Int?
  Categoria   Categoria? @relation(fields: [categoriaId], references: [idCategoria])

  provaPraticaId Int?
  ProvaPratica   ProvaPratica? @relation(fields: [provaPraticaId], references: [idProvaPratica])

  blocoProvaId Int?
  BlocoProva   BlocoProva? @relation(fields: [blocoProvaId], references: [idBloco])

  dataAtribuicao DateTime @default(now())

  @@unique([comissaoId, categoriaId, provaPraticaId, blocoProvaId])
}

model ComissaoUsuario {
  idComissaoUsuario Int      @id @default(autoincrement())
  comissaoId        Int
  usuarioId         Int      @unique
  Comissao          Comissao @relation(fields: [comissaoId], references: [idComissao])
  Usuarios          Usuario  @relation(fields: [usuarioId], references: [idUsuario])

  @@unique([comissaoId, usuarioId])
}

model Categoria {
  idCategoria   Int    @id @default(autoincrement())
  nomeCategoria String @db.VarChar(50)
  escolaridade  String
  sorteioDanca  Int
  idadeInicial  Int
  idadeLimite   Int?

  candidatos Candidato[]

  provaTeoricaId Int?
  ProvaTeorica   ProvaTeorica? @relation(fields: [provaTeoricaId], references: [idprovaTeorica], onDelete: SetNull)

  provaPraticaId        Int?
  ProvaPratica          ProvaPratica?          @relation(fields: [provaPraticaId], references: [idProvaPratica], onDelete: SetNull)
  comissaoProvaPraticas ComissaoProvaPratica[]
}

model Avaliacao {
  idAvalicao    Int      @id @default(autoincrement())
  dataAvaliacao DateTime @default(now())
  notaFinal     Float?

  comissaoId Int?
  Comissao   Comissao @relation(fields: [comissaoId], references: [idComissao])

  avaliadorId Int
  Usuario     Usuario @relation(fields: [avaliadorId], references: [idUsuario])

  candidatoId Int
  Candidato   Candidato @relation(fields: [candidatoId], references: [idCandidato])

  provaPraticaId Int?
  ProvaPratica   ProvaPratica? @relation(fields: [provaPraticaId], references: [idProvaPratica])

  provaTeoricaId Int?
  ProvaTeorica   ProvaTeorica? @relation(fields: [provaTeoricaId], references: [idprovaTeorica])

  blocoProvaId Int?
  BlocoProva   BlocoProva? @relation(fields: [blocoProvaId], references: [idBloco])

  fichaCandidatoIdFicha Int?
  FichaCandidato        FichaCandidato? @relation(fields: [fichaCandidatoIdFicha], references: [idFicha])

  quesitosAvaliados AvaliacaoQuesito[]
}

model AvaliacaoQuesito {
  idAvaliacaoQuesito   Int                   @id @default(autoincrement())
  notaQuesito          Float
  comentario           String?
  subQuesitosAvaliados AvaliacaoSubQuesito[]

  avaliacaoId Int
  Avaliacao   Avaliacao @relation(fields: [avaliacaoId], references: [idAvalicao], onDelete: Cascade)

  quesitoId Int
  Quesito   Quesitos @relation(fields: [quesitoId], references: [idQuesito])

  @@unique([avaliacaoId, quesitoId])
}

model AvaliacaoSubQuesito {
  idAvaliacaoSubQuesito Int   @id @default(autoincrement())
  notaSubQuesito        Float

  subQuesitoId Int
  SubQuesito   SubQuesitos @relation(fields: [subQuesitoId], references: [idSubequestios])

  avaliacaoQuesitoId Int?
  AvaliacaoQuesito   AvaliacaoQuesito? @relation(fields: [avaliacaoQuesitoId], references: [idAvaliacaoQuesito])

  @@unique([avaliacaoQuesitoId, subQuesitoId])
}

model ProvaTeorica {
  idprovaTeorica  Int         @id @default(autoincrement())
  nomeProva       String
  notaMaxima      Float
  gabaritoOficial Bytes?
  numQuestao      Int
  quesitos        Quesitos[]
  categorias      Categoria[]
  avaliacoes      Avaliacao[]
  recursos        Recurso[]
}

model ProvaPratica {
  idProvaPratica        Int                    @id @default(autoincrement())
  nomeProva             String
  notaMaxima            Float
  blocosProvas          BlocoProva[]
  categorias            Categoria[]
  avaliacoes            Avaliacao[]
  recursos              Recurso[]
  comissaoProvaPraticas ComissaoProvaPratica[]
}

model BlocoProva {
  idBloco               Int                    @id @default(autoincrement())
  nomeBloco             String
  notaMaximaBloco       Float
  ProvaPratica          ProvaPratica?          @relation(fields: [provaPraticaId], references: [idProvaPratica])
  provaPraticaId        Int?
  quesitos              Quesitos[]
  Avaliacao             Avaliacao[]
  comissaoProvaPraticas ComissaoProvaPratica[]
}

model Quesitos {
  idQuesito         Int     @id @default(autoincrement())
  nomeQuesito       String
  notaMaximaQuesito Float
  opcional          Boolean @default(false)

  BlocoProva        BlocoProva? @relation(fields: [blocoProvaIdBloco], references: [idBloco])
  blocoProvaIdBloco Int?

  ProvaTeorica               ProvaTeorica? @relation(fields: [provaTeoricaIdprovaTeorica], references: [idprovaTeorica])
  provaTeoricaIdprovaTeorica Int?

  subQuesitos       SubQuesitos[]
  recursos          Recurso[]
  dancas            Danca[]
  avaliacaoQuesitos AvaliacaoQuesito[]
}

model SubQuesitos {
  idSubequestios  Int    @id @default(autoincrement())
  nomeSubquesito  String
  notaSubequesito Float

  quesitoId Int
  Quesito   Quesitos @relation(fields: [quesitoId], references: [idQuesito])

  subequesitosFilhos   SubQuesitos[]         @relation("SubQuesitosSub")
  subequesitosPai      SubQuesitos[]         @relation("SubQuesitosSub")
  avaliacaoSubQuesitos AvaliacaoSubQuesito[]
}

model Recurso {
  idRecurso     Int      @id @default(autoincrement())
  nomeRecurso   String
  justificativa String
  status        Boolean
  dataRecurso   DateTime @default(now())
  arquivos      Bytes

  candidato Int
  Candidato Candidato @relation(fields: [candidato], references: [idCandidato])
  avaliador Int
  Usuario   Usuario   @relation(fields: [avaliador], references: [idUsuario])

  quesitoRecurso             Int
  Quesito                    Quesitos      @relation(fields: [quesitoRecurso], references: [idQuesito])
  ProvaTeorica               ProvaTeorica? @relation(fields: [provaTeoricaIdprovaTeorica], references: [idprovaTeorica])
  provaTeoricaIdprovaTeorica Int?
  ProvaPratica               ProvaPratica? @relation(fields: [provaPraticaIdProvaPratica], references: [idProvaPratica])
  provaPraticaIdProvaPratica Int?
}

model Danca {
  idDanca                              Int                      @id @default(autoincrement())
  nomeDanca                            String
  dancaSalaoTradicional                DancaSalaoTradicional
  quesitoId                            Int
  preferenciaSorteioDanca              PreferenciaSorteioDanca? @relation(fields: [preferenciaSorteioDancaIdPreferencia], references: [idPreferencia])
  preferenciaSorteioDancaIdPreferencia Int?
  quesitos                             Quesitos?                @relation(fields: [quesitosIdQuesito], references: [idQuesito])
  quesitosIdQuesito                    Int?
}

enum DancaSalaoTradicional {
  DANCA_DE_SALAO
  DANCA_TRADICIONAL
  NENHUMA
}

model SorteioDanca {
  idSorteio        Int                   @id @default(autoincrement())
  resultadoSorteio Int
  dataSorteio      DateTime              @default(now())
  tipoDanca        DancaSalaoTradicional

  preferenciaSorteioDancaIds PreferenciaSorteioDanca[]

  candidatoId Int
  Candidato   Candidato @relation(fields: [candidatoId], references: [idCandidato])

  usuarioId Int
  Usuario   Usuario @relation(fields: [usuarioId], references: [idUsuario])
}

model FichaCandidato {
  idFicha       Int         @id @default(autoincrement())
  candidatoId   Int
  notaCandidato Float
  avaliacoes    Avaliacao[]
  concursoId    Int

  anexoTermodeCiencia Bytes
  dataTermo           DateTime @default(now())

  numAcertosProvaTeorica Int
  anexoGabarito          Bytes
  notaRedacao            Float
  anexoRedacao           Bytes

  notaFinalProvasPraticas Float
  anexoProvaPratica       Bytes

  @@unique([candidatoId, concursoId])
}

